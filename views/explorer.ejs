<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Explorer Page - Pasaana</title>
  <meta name="description" content="Explore properties on Pasaana">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Tailwind CSS -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <!-- Custom Styles -->
  <link rel="stylesheet" href="/styles.css">
  <!-- Include jQuery for AJAX requests -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    /* Custom styles if needed */
  </style>
</head>
<body class="bg-gray-100 text-gray-800">
  <!-- Navigation Bar -->
  <%- include('partials/navbar.ejs') %>

  <!-- Helper Functions -->
  <%
    function formatNumber(value) {
      return value != null ? value.toLocaleString() : 'N/A';
    }

    function formatCurrency(value) {
      return value != null ? '$' + value.toLocaleString() : 'N/A';
    }

    function formatText(value) {
      return value != null && value.toString().trim() !== '' ? value : 'N/A';
    }
  %>

  <!-- Header with Search and Filters -->
  <div class="w-full px-6 py-4">
    <div class="flex items-center">
      <!-- Left side: Search and Filters -->
      <div class="flex items-center space-x-2">
        <!-- Search Bar -->
        <div class="flex-shrink-0">
          <input type="text" placeholder="Search location (e.g., 'Darien CT')" 
            class="w-96 px-4 py-2 border rounded-md" />
        </div>

        <!-- Filters -->
        <div class="flex items-center space-x-2">
          <!-- For Sale Dropdown -->
          <div class="relative inline-block text-left">
            <button onclick="toggleDropdown('status-dropdown')" class="inline-flex justify-center w-full px-4 py-2 text-sm font-medium text-gray-700 bg-white border rounded-md hover:bg-gray-50">
              <span id="selected-status">For Sale</span>
              <!-- Arrow Icon -->
              <svg class="w-5 h-5 ml-2 -mr-1" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06-.02L10 10.8l3.71-3.61a.75.75 0 111.04 1.08l-4.24 4.12a.75.75 0 01-1.04 0L5.21 8.27a.75.75 0 01.02-1.06z" clip-rule="evenodd"/>
              </svg>
            </button>
            <!-- Dropdown menu -->
            <div id="status-dropdown" class="hidden origin-top-left absolute left-0 mt-2 w-40 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5">
              <div class="py-1" role="menu" aria-orientation="vertical" aria-labelledby="options-menu">
                <!-- For Sale Option -->
                <a href="#" onclick="selectStatus('For Sale')" class="flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100">
                  <!-- Circle Icon -->
                  <span class="mr-2">
                    <svg id="circle-For Sale" class="w-4 h-4 text-blue-500" fill="currentColor" viewBox="0 0 24 24">
                      <circle cx="12" cy="12" r="10"></circle>
                    </svg>
                  </span>
                  For Sale
                </a>
                <!-- For Rent Option -->
                <a href="#" onclick="selectStatus('For Rent')" class="flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100">
                  <!-- Circle Icon -->
                  <span class="mr-2">
                    <svg id="circle-For Rent" class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <circle cx="12" cy="12" r="10"></circle>
                    </svg>
                  </span>
                  For Rent
                </a>
                <!-- Sold Option -->
                <a href="#" onclick="selectStatus('Sold')" class="flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100">
                  <!-- Circle Icon -->
                  <span class="mr-2">
                    <svg id="circle-Sold" class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <circle cx="12" cy="12" r="10"></circle>
                    </svg>
                  </span>
                  Sold
                </a>
              </div>
            </div>
          </div>
          <!-- Price Dropdown -->
          <div class="relative inline-block text-left">
            <button onclick="toggleDropdown('price-dropdown')" class="inline-flex justify-center w-full px-4 py-2 text-sm font-medium text-gray-700 bg-white border rounded-md hover:bg-gray-50">
              <span id="selected-price">Price</span>
              <!-- Arrow Icon -->
              <svg class="w-5 h-5 ml-2 -mr-1" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06-.02L10 10.8l3.71-3.61a.75.75 0 111.04 1.08l-4.24 4.12a.75.75 0 01-1.04 0L5.21 8.27a.75.75 0 01.02-1.06z" clip-rule="evenodd"/>
              </svg>
            </button>
            <!-- Dropdown menu -->
            <div id="price-dropdown" class="hidden origin-top-left absolute left-0 mt-2 w-64 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-50">
              <div class="p-4 space-y-4">
                <!-- List Price or Monthly Payment Toggle -->
                <div class="flex items-center space-x-4">
                  <button id="list-price-btn" onclick="selectPriceType('List Price')" class="px-3 py-1 bg-blue-600 text-white rounded-md">List Price</button>
                  <button id="monthly-payment-btn" onclick="selectPriceType('Monthly Payment')" class="px-3 py-1 bg-gray-200 text-gray-700 rounded-md">Monthly Payment</button>
                </div>
                <!-- Min and Max Price Inputs -->
                <div class="flex items-center space-x-2">
                  <input type="text" id="min-price" placeholder="Min" class="w-full px-4 py-2 border rounded-md" />
                  <span class="text-gray-500">-</span>
                  <input type="text" id="max-price" placeholder="Max" class="w-full px-4 py-2 border rounded-md" />
                </div>
                <!-- Apply and Cancel Buttons -->
                <div class="flex justify-end space-x-2">
                  <button onclick="clearPriceFilter()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md">Cancel</button>
                  <button onclick="applyPriceFilter()" class="px-4 py-2 bg-blue-600 text-white rounded-md">Apply</button>
                </div>
              </div>
            </div>
          </div>
          <!-- Beds & Baths Dropdown -->
          <div class="relative inline-block text-left">
            <button onclick="toggleDropdown('beds-baths-dropdown')" class="inline-flex justify-center w-full px-4 py-2 text-sm font-medium text-gray-700 bg-white border rounded-md hover:bg-gray-50">
              <span id="selected-beds-baths">Beds & Baths</span>
              <!-- Arrow Icon -->
              <svg class="w-5 h-5 ml-2 -mr-1" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06-.02L10 10.8l3.71-3.61a.75.75 0 111.04 1.08l-4.24 4.12a.75.75 0 01-1.04 0L5.21 8.27a.75.75 0 01.02-1.06z" clip-rule="evenodd"/>
              </svg>
            </button>
            <!-- Dropdown menu -->
            <div id="beds-baths-dropdown" class="hidden origin-top-left absolute left-0 mt-2 w-64 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-50">
              <div class="p-4 space-y-4">
                <!-- Exact Match Toggle -->
                <div class="flex items-center justify-between">
                  <span class="font-semibold text-gray-700">Exact Match</span>
                  <button id="exact-match-toggle" onclick="toggleExactMatch()" class="w-12 h-6 bg-gray-200 rounded-full relative focus:outline-none">
                    <span id="toggle-circle" class="w-6 h-6 bg-white rounded-full shadow absolute left-0 top-0 transition-transform duration-200"></span>
                  </button>
                </div>
                <!-- Bedrooms Selection -->
                <div>
                  <span class="font-semibold text-gray-700">Bedrooms</span>
                  <div class="grid grid-cols-6 gap-2 mt-2">
                    <% const bedOptions = ['Any', '1', '2', '3', '4', '5+']; %>
                    <% bedOptions.forEach(function(option) { %>
                      <button onclick="selectBeds('<%= option %>')" id="beds-<%= option %>" class="px-2 py-1 border rounded-md text-gray-700 hover:bg-gray-100">
                        <%= option %>
                      </button>
                    <% }); %>
                  </div>
                </div>
                <!-- Bathrooms Selection -->
                <div>
                  <span class="font-semibold text-gray-700">Bathrooms</span>
                  <div class="grid grid-cols-6 gap-2 mt-2">
                    <% const bathOptions = ['Any', '1', '2', '3', '4', '5+']; %>
                    <% bathOptions.forEach(function(option) { %>
                      <button onclick="selectBaths('<%= option %>')" id="baths-<%= option %>" class="px-2 py-1 border rounded-md text-gray-700 hover:bg-gray-100">
                        <%= option %>
                      </button>
                    <% }); %>
                  </div>
                </div>
                <!-- Apply and Cancel Buttons -->
                <div class="flex justify-end space-x-2 mt-4">
                  <button onclick="clearBedsBathsFilter()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md">Cancel</button>
                  <button onclick="applyBedsBathsFilter()" class="px-4 py-2 bg-blue-600 text-white rounded-md">Apply</button>
                </div>
              </div>
            </div>
          </div>
          <!-- Property Type Dropdown -->
          <div class="relative inline-block text-left">
            <button onclick="toggleDropdown('property-type-dropdown')" class="inline-flex justify-center w-full px-4 py-2 text-sm font-medium text-gray-700 bg-white border rounded-md hover:bg-gray-50">
              <span id="selected-property-type">Property Type</span>
              <!-- Arrow Icon -->
              <svg class="w-5 h-5 ml-2 -mr-1" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06-.02L10 10.8l3.71-3.61a.75.75 0 111.04 1.08l-4.24 4.12a.75.75 0 01-1.04 0L5.21 8.27a.75.75 0 01.02-1.06z" clip-rule="evenodd"/>
              </svg>
            </button>
            <!-- Dropdown menu -->
            <div id="property-type-dropdown" class="hidden origin-top-left absolute left-0 mt-2 w-64 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-50">
              <div class="p-4 space-y-4">
                <!-- Property Type Selection -->
                <div>
                  <span class="font-semibold text-gray-700">Property Type</span>
                  <div class="grid grid-cols-2 gap-2 mt-2">
                    <% const propertyTypes = ['House', 'Condo', 'Townhouse', 'Multi-Family', 'Land', 'Manufactured', 'Other']; %>
                    <% propertyTypes.forEach(function(type) { %>
                      <button onclick="togglePropertyType('<%= type %>')" id="property-type-<%= type.replace(' ', '-') %>" class="flex items-center px-2 py-1 border rounded-md text-gray-700 hover:bg-gray-100">
                        <!-- Checkbox Icon -->
                        <span class="mr-2">
                          <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <rect x="2" y="2" width="20" height="20" rx="2" ry="2" class="text-gray-700"></rect>
                            <polyline points="4 12 9 17 20 6" id="checkmark-<%= type.replace(' ', '-') %>" class="hidden text-blue-600"></polyline>
                          </svg>
                        </span>
                        <%= type %>
                      </button>
                    <% }); %>
                  </div>
                </div>
                <!-- Apply and Cancel Buttons -->
                <div class="flex justify-end space-x-2 mt-4">
                  <button onclick="clearPropertyTypeFilter()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md">Cancel</button>
                  <button onclick="applyPropertyTypeFilter()" class="px-4 py-2 bg-blue-600 text-white rounded-md">Apply</button>
                </div>
              </div>
            </div>
          </div>
          <!-- Add Advanced Filters Dropdown -->
          <div class="relative inline-block text-left">
            <button onclick="toggleDropdown('advanced-filters-dropdown')" class="inline-flex justify-center w-full px-4 py-2 text-sm font-medium text-gray-700 bg-white border rounded-md hover:bg-gray-50">
              <span>More Filters</span>
              <!-- Arrow Icon -->
              <svg class="w-5 h-5 ml-2 -mr-1" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06-.02L10 10.8l3.71-3.61a.75.75 0 111.04 1.08l-4.24 4.12a.75.75 0 01-1.04 0L5.21 8.27a.75.75 0 01.02-1.06z" clip-rule="evenodd"/>
              </svg>
            </button>
            <!-- Dropdown menu -->
            <div id="advanced-filters-dropdown" class="hidden origin-top-left absolute left-0 mt-2 w-96 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-50">
              <div class="p-4 space-y-4">
                <!-- Amenities Filter -->
                <div>
                  <span class="font-semibold text-gray-700">Amenities</span>
                  <div class="grid grid-cols-2 gap-2 mt-2">
                    <% const amenitiesList = ['Pool', 'Gym', 'Parking', 'Laundry', 'Pet-Friendly', 'Fireplace']; %>
                    <% amenitiesList.forEach(function(amenity) { %>
                      <button onclick="toggleAmenity('<%= amenity %>')" id="amenity-<%= amenity.replace(' ', '-') %>" class="flex items-center px-2 py-1 border rounded-md text-gray-700 hover:bg-gray-100">
                        <!-- Checkbox Icon -->
                        <span class="mr-2">
                          <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <rect x="2" y="2" width="20" height="20" rx="2" ry="2" class="text-gray-700"></rect>
                            <polyline points="4 12 9 17 20 6" id="amenity-checkmark-<%= amenity.replace(' ', '-') %>" class="hidden text-blue-600"></polyline>
                          </svg>
                        </span>
                        <%= amenity %>
                      </button>
                    <% }); %>
                  </div>
                </div>
                <!-- Schools Filter -->
                <div>
                  <span class="font-semibold text-gray-700">Schools</span>
                  <div class="flex items-center mt-2">
                    <input type="number" id="school-rating" placeholder="Minimum Rating (1-10)" min="1" max="10" class="w-full px-4 py-2 border rounded-md" />
                  </div>
                </div>
                <!-- Features Filter -->
                <div>
                  <span class="font-semibold text-gray-700">Features</span>
                  <div class="grid grid-cols-2 gap-2 mt-2">
                    <% const featuresList = ['New Construction', 'Reduced Price', 'Open Houses', 'Virtual Tour Available']; %>
                    <% featuresList.forEach(function(feature) { %>
                      <button onclick="toggleFeature('<%= feature %>')" id="feature-<%= feature.replace(' ', '-') %>" class="flex items-center px-2 py-1 border rounded-md text-gray-700 hover:bg-gray-100">
                        <!-- Checkbox Icon -->
                        <span class="mr-2">
                          <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <rect x="2" y="2" width="20" height="20" rx="2" ry="2" class="text-gray-700"></rect>
                            <polyline points="4 12 9 17 20 6" id="feature-checkmark-<%= feature.replace(' ', '-') %>" class="hidden text-blue-600"></polyline>
                          </svg>
                        </span>
                        <%= feature %>
                      </button>
                    <% }); %>
                  </div>
                </div>
                <!-- Apply and Cancel Buttons -->
                <div class="flex justify-end space-x-2 mt-4">
                  <button onclick="clearAdvancedFilters()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md">Cancel</button>
                  <button onclick="applyAdvancedFilters()" class="px-4 py-2 bg-blue-600 text-white rounded-md">Apply</button>
                </div>
              </div>
            </div>
          </div>
          <!-- More Dropdown -->
          <!-- ... -->
        </div>

        <!-- Save Search Button -->
        <button class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
          Save Search
        </button>
      </div>

      <!-- Right side: Map/List Toggle -->
      <div class="flex-shrink-0 ml-auto">
        <button id="toggle-view-btn" onclick="toggleView()" 
          class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300">
          <span id="toggle-view-text">List View</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="flex" id="main-content">
    <!-- Map Placeholder -->
    <div id="map-container" class="w-3/5 h-screen">
      <img src="/images/map.jpeg" alt="Map Placeholder" class="w-full h-full object-cover">
    </div>

    <!-- Property Listings Section -->
    <div id="listings-container" class="w-2/5 h-screen overflow-y-auto">
      <!-- Property Listings Grid -->
      <div id="listings-grid" class="grid grid-cols-2 gap-6 p-4">
        <% for (let i = 0; i < 10; i++) { %>
          <% 
            // Use PropertyID 1 for all listings
            const property = properties.find(p => p.PropertyID === 1); 
            const propertyImages = images.filter(img => img.PropertyID === property.PropertyID);
          %>
          <a href="/property/<%= property.PropertyID %>" class="block">
            <div class="property-card border hover:bg-gray-100 p-4 pb-10 rounded-md flex flex-col relative">
              <!-- Image Container -->
              <div class="w-full">
                <% if (propertyImages && propertyImages.length > 0) { %>
                  <img src="<%= propertyImages[0].Url %>" alt="Property Image" class="property-image w-full object-cover rounded-md">
                <% } else { %>
                  <div class="property-image w-full bg-gray-200 flex items-center justify-center rounded-md">
                    <span class="text-gray-500">No Image</span>
                  </div>
                <% } %>
              </div>
              <!-- Property Details -->
              <div class="property-details mt-2">
                <h2 class="text-lg font-semibold"><%= formatText(property.Address) %></h2>
                <p class="text-gray-500 text-sm"><%= formatText(property.City) %>, <%= formatText(property.State) %></p>
                <p class="text-gray-700 font-semibold mt-1"><%= formatCurrency(property.ListingPrice) %></p>
                <p class="text-gray-600 text-sm mt-1">
                  <%= property.Bedrooms != null ? property.Bedrooms : 'N/A' %> bds •
                  <%= property.TotalBathrooms != null ? property.TotalBathrooms : 'N/A' %> ba •
                  <%= formatNumber(property.PropertySize) %> sqft
                </p>
                <p class="text-gray-500 text-xs mt-1">7 days on Pasaana</p>
              </div>
              <!-- Heart Icon -->
              <button class="heart-icon absolute bottom-2 right-2 focus:outline-none">
                <!-- Heart Icon SVG -->
                <svg class="w-6 h-6 text-gray-400 hover:text-red-500" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M12 21.35l-1.45-1.32C5.4 15.36 
                  2 12.28 2 8.5 2 5.42 
                  4.42 3 7.5 3c1.74 0 3.41.81 
                  4.5 2.09C13.09 3.81 14.76 3 
                  16.5 3 19.58 3 22 5.42 22 
                  8.5c0 3.78-3.4 6.86-8.55 
                  11.54L12 21.35z"/>
                </svg>
              </button>
            </div>
          </a>
        <% } %>
      </div>
    </div>
  </div>

  <!-- Chatbot -->
  <%- include('partials/chatbot.ejs') %>

  <!-- Footer -->
  <footer class="bg-blue-900 text-white text-center py-4">
    <p>© 2024 Pasaana. All rights reserved.</p>
  </footer>

  <!-- Include your JavaScript file or script here -->
  <script src="/explorer.js"></script>
</body>
</html>