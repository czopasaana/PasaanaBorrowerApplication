<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pre-Approval - Step 4</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Custom Styles -->
  <link rel="stylesheet" href="/styles.css">
  <!-- Include jQuery for AJAX requests -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="bg-gradient-to-r from-blue-50 to-indigo-50 min-h-screen flex flex-col">
  <!-- Navigation Bar -->
  <%- include('../partials/navbar.ejs') %>

  <!-- Progress Bar -->
  <%- include('../partials/progress-bar.ejs', { currentStep: 4 }) %>

  <!-- Main Content -->
  <main class="flex-grow container mx-auto py-0 px-4">
    <div class="max-w-2xl mx-auto bg-white p-10 rounded-xl shadow-2xl">
      <h2 class="text-3xl font-bold text-blue-900 mb-8">Step 4: Social Security Number Collection</h2>
      <form action="/preapproval/step/4" method="post" id="step4-form">
        <!-- SSN Entry -->
        <div class="mb-6">
          <p class="text-gray-700 mb-4">
            To proceed, we need your Social Security Number for the credit check. Rest assured, this is a soft inquiry and will not affect your credit score.
          </p>
          <p class="text-gray-700 mb-4">
            <strong>Security Assurance:</strong> Your SSN is encrypted and securely stored. Your privacy and security are our top priorities.
          </p>
          <label for="ssn" class="block text-gray-800 font-medium mb-2">Social Security Number<span class="text-red-500">*</span></label>
          <input type="text" name="ssn" id="ssn" placeholder="XXX-XX-XXXX" required class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500">
          <p id="ssnError" class="text-red-500 text-sm mt-1 hidden">Please enter a valid SSN.</p>
          <!-- Optional Help -->
          <p class="text-gray-600 mt-2">
            <a href="#" id="whySSN" class="text-blue-600 hover:underline">Why do we need this?</a>
          </p>
          <div id="ssnExplanation" class="mt-2 text-gray-600 hidden">
            We require your Social Security Number to perform a soft credit check, which helps us provide an accurate pre-approval assessment. This is a standard requirement and will not affect your credit score.
          </div>
        </div>

        <!-- Certification -->
        <div class="mb-6">
          <label class="inline-flex items-center">
            <input type="checkbox" name="certifySSN" required class="form-checkbox h-5 w-5 text-blue-600">
            <span class="ml-2 text-gray-700">I certify that the Social Security Number provided is accurate.<span class="text-red-500">*</span></span>
          </label>
        </div>

        <button type="submit" class="w-full bg-blue-900 text-white py-3 mt-6 rounded-full font-semibold text-lg shadow-md hover:bg-blue-800 transition duration-300">Continue</button>
      </form>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-blue-900 text-white text-center py-6">
    <p>Â© 2024 Pasaana. All rights reserved.</p>
  </footer>

  <!-- JavaScript for validation and help toggle -->
  <script>
    $(document).ready(function() {
      // Toggle SSN explanation
      $('#whySSN').on('click', function(e) {
        e.preventDefault();
        $('#ssnExplanation').toggleClass('hidden');
      });

      // Real-time SSN validation
      $('#ssn').on('input', function() {
        const ssnPattern = /^(?!000|666|9\d{2})(\d{3})[- ]?(?!00)(\d{2})[- ]?(?!0000)(\d{4})$/;
        const isValid = ssnPattern.test($(this).val());
        $('#ssnError').toggleClass('hidden', isValid);
      });

      // Form submission validation
      $('#step4-form').on('submit', function(e) {
        let isFormValid = true;

        // SSN validation
        const ssnPattern = /^(?!000|666|9\d{2})(\d{3})[- ]?(?!00)(\d{2})[- ]?(?!0000)(\d{4})$/;
        if (!ssnPattern.test($('#ssn').val())) {
          $('#ssnError').removeClass('hidden');
          isFormValid = false;
        }

        if (!isFormValid) {
          e.preventDefault();
        }
      });
    });
  </script>
</body>
</html>