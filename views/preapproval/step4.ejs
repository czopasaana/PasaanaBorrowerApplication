<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pre-Approval - Step 4</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Include jQuery for AJAX requests -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="bg-gradient-to-r from-blue-50 to-indigo-50 min-h-screen flex flex-col">
  <!-- Navigation Bar -->
  <%- include('../partials/navbar.ejs') %>

  <!-- Progress Bar -->
  <%- include('../partials/progress-bar.ejs', { currentStep: 4 }) %>

  <!-- Main Content -->
  <main class="flex-grow container mx-auto py-0 px-4">
    <div class="max-w-3xl mx-auto bg-white p-10 rounded-xl shadow-2xl">
      <h2 class="text-3xl font-bold text-blue-900 mb-8">Step 4: Employment and Income Information</h2>
      <form action="/preapproval/step/4" method="post" id="step4-form">
        <!-- Employment Status -->
        <div class="mb-6">
          <label for="employmentStatus" class="block text-gray-700 font-medium mb-2">What is your current employment status?</label>
          <select name="employmentStatus" id="employmentStatus" required class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="">Select an option</option>
            <option value="employed_full_time">Employed Full-Time</option>
            <option value="employed_part_time">Employed Part-Time</option>
            <option value="self_employed">Self-Employed</option>
            <option value="unemployed">Unemployed</option>
            <option value="retired">Retired</option>
            <option value="other">Other</option>
          </select>
        </div>

        <!-- Employed Fields -->
        <div id="employedFields" class="mb-6 hidden">
          <div class="mb-6">
            <label for="employerName" class="block text-gray-700 font-medium mb-2">Employer Name:</label>
            <input type="text" name="employerName" id="employerName" class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>
          <div class="mb-6">
            <label for="jobTitle" class="block text-gray-700 font-medium mb-2">Job Title/Position:</label>
            <input type="text" name="jobTitle" id="jobTitle" class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>
          <div class="mb-6">
            <label for="employmentLength" class="block text-gray-700 font-medium mb-2">How long have you been employed at your current job?</label>
            <select name="employmentLength" id="employmentLength" class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500">
              <option value="">Select an option</option>
              <option value="<1">&lt; 1 year</option>
              <option value="1-2">1-2 years</option>
              <option value="2-5">2-5 years</option>
              <option value=">5">&gt; 5 years</option>
            </select>
          </div>
          <div class="mb-6">
            <label for="annualIncome" class="block text-gray-700 font-medium mb-2">Annual Gross Income (USD):</label>
            <input type="number" name="annualIncome" id="annualIncome" class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>
        </div>

        <!-- Self-Employed Fields -->
        <div id="selfEmployedFields" class="mb-6 hidden">
          <div class="mb-6">
            <label for="businessName" class="block text-gray-700 font-medium mb-2">Business Name:</label>
            <input type="text" name="businessName" id="businessName" class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>
          <div class="mb-6">
            <label for="industry" class="block text-gray-700 font-medium mb-2">Industry:</label>
            <input type="text" name="industry" id="industry" class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>
          <div class="mb-6">
            <label for="selfEmploymentLength" class="block text-gray-700 font-medium mb-2">How long have you been self-employed?</label>
            <select name="selfEmploymentLength" id="selfEmploymentLength" class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500">
              <option value="">Select an option</option>
              <option value="<1">&lt; 1 year</option>
              <option value="1-2">1-2 years</option>
              <option value="2-5">2-5 years</option>
              <option value=">5">&gt; 5 years</option>
            </select>
          </div>
          <div class="mb-6">
            <label for="selfAnnualIncome" class="block text-gray-700 font-medium mb-2">Annual Gross Income (USD):</label>
            <input type="number" name="selfAnnualIncome" id="selfAnnualIncome" class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>
        </div>

        <!-- Other Fields -->
        <div id="otherFields" class="mb-6 hidden">
          <div class="mb-6">
            <label for="incomeSource" class="block text-gray-700 font-medium mb-2">Please specify your primary source of income:</label>
            <input type="text" name="incomeSource" id="incomeSource" class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>
          <div class="mb-6">
            <label for="otherAnnualIncome" class="block text-gray-700 font-medium mb-2">Annual Income (USD):</label>
            <input type="number" name="otherAnnualIncome" id="otherAnnualIncome" class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>
        </div>

        <!-- Additional Income -->
        <div class="mb-6">
          <label for="additionalIncome" class="block text-gray-700 font-medium mb-2">Do you have any additional sources of income?</label>
          <select name="additionalIncome" id="additionalIncome" required class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="">Select an option</option>
            <option value="yes">Yes</option>
            <option value="no">No</option>
          </select>
        </div>
        <div id="additionalIncomeDetails" class="mb-6 hidden">
          <div id="additionalIncomeEntries">
            <!-- Template for additional income entry -->
            <div class="additional-income-entry mb-6">
              <div class="mb-6">
                <label class="block text-gray-700 font-medium mb-2">Type of Income:</label>
                <select name="additionalIncomeType[]" class="additionalIncomeType w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500">
                  <option value="">Select an option</option>
                  <option value="rental_income">Rental Income</option>
                  <option value="investment_income">Investment Income</option>
                  <option value="alimony_child_support">Alimony/Child Support</option>
                  <option value="other">Other</option>
                </select>
              </div>
              <div class="mb-6">
                <label class="block text-gray-700 font-medium mb-2">Annual Amount (USD):</label>
                <input type="number" name="additionalIncomeAmount[]" class="additionalIncomeAmount w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500">
              </div>
            </div>
          </div>
          <button type="button" id="addAdditionalIncome" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition">Add Another Income Source</button>
        </div>

        <button type="submit" class="w-full bg-blue-900 text-white py-3 mt-6 rounded-full font-semibold text-lg shadow-md hover:bg-blue-800 transition duration-300">Continue</button>
      </form>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-blue-900 text-white text-center py-6">
    <p>Â© 2024 Pasaana. All rights reserved.</p>
  </footer>

  <!-- JavaScript for Conditional Logic -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const employmentStatus = document.getElementById('employmentStatus');
      const employedFields = document.getElementById('employedFields');
      const selfEmployedFields = document.getElementById('selfEmployedFields');
      const otherFields = document.getElementById('otherFields');
      const additionalIncome = document.getElementById('additionalIncome');
      const additionalIncomeDetails = document.getElementById('additionalIncomeDetails');
      const addAdditionalIncome = document.getElementById('addAdditionalIncome');
      const additionalIncomeEntries = document.getElementById('additionalIncomeEntries');

      employmentStatus.addEventListener('change', function() {
        // Hide all conditional sections and remove required attributes
        hideAllEmploymentFields();

        if (this.value === 'employed_full_time' || this.value === 'employed_part_time') {
          employedFields.classList.remove('hidden');
          addRequiredToFields(employedFields);
        } else if (this.value === 'self_employed') {
          selfEmployedFields.classList.remove('hidden');
          addRequiredToFields(selfEmployedFields);
        } else if (this.value === 'unemployed' || this.value === 'retired' || this.value === 'other') {
          otherFields.classList.remove('hidden');
          addRequiredToFields(otherFields);
        }
      });

      additionalIncome.addEventListener('change', function() {
        if (this.value === 'yes') {
          additionalIncomeDetails.classList.remove('hidden');
          addRequiredToFields(additionalIncomeDetails);
        } else {
          additionalIncomeDetails.classList.add('hidden');
          removeRequiredFromFields(additionalIncomeDetails);
        }
      });

      addAdditionalIncome.addEventListener('click', function() {
        const newEntry = document.createElement('div');
        newEntry.classList.add('additional-income-entry', 'mb-6');
        newEntry.innerHTML = `
          <div class="mb-6">
            <label class="block text-gray-700 font-medium mb-2">Type of Income:</label>
            <select name="additionalIncomeType[]" class="additionalIncomeType w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
              <option value="">Select an option</option>
              <option value="rental_income">Rental Income</option>
              <option value="investment_income">Investment Income</option>
              <option value="alimony_child_support">Alimony/Child Support</option>
              <option value="other">Other</option>
            </select>
          </div>
          <div class="mb-6">
            <label class="block text-gray-700 font-medium mb-2">Annual Amount (USD):</label>
            <input type="number" name="additionalIncomeAmount[]" class="additionalIncomeAmount w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
          </div>
        `;
        additionalIncomeEntries.appendChild(newEntry);
      });

      function hideAllEmploymentFields() {
        employedFields.classList.add('hidden');
        selfEmployedFields.classList.add('hidden');
        otherFields.classList.add('hidden');
        removeRequiredFromFields(employedFields);
        removeRequiredFromFields(selfEmployedFields);
        removeRequiredFromFields(otherFields);
      }

      function addRequiredToFields(section) {
        const inputs = section.querySelectorAll('input, select');
        inputs.forEach(input => {
          input.setAttribute('required', 'required');
        });
      }

      function removeRequiredFromFields(section) {
        const inputs = section.querySelectorAll('input, select');
        inputs.forEach(input => {
          input.removeAttribute('required');
        });
      }
    });
  </script>
</body>
</html>