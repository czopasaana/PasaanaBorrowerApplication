<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pre-Approval - Step 4</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Link to CSS -->
  <link rel="stylesheet" href="/styles.css">
</head>
<body class="bg-gray-100">
  <!-- Navigation Bar -->
  <%- include('../partials/navbar.ejs') %>

  <!-- Main Content -->
  <main class="container mx-auto py-8 px-4">
    <div class="max-w-2xl mx-auto bg-white p-8 rounded-lg shadow-lg">
      <h2 class="text-2xl font-bold text-blue-900 mb-6">Step 4: Employment and Income Information</h2>
      <form action="/preapproval/step/4" method="post" id="step4-form">
        <!-- Employment Status -->
        <div class="mb-4">
          <label for="employmentStatus" class="block text-gray-700 mb-2">What is your current employment status?</label>
          <select name="employmentStatus" id="employmentStatus" required class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="">Select an option</option>
            <option value="employed_full_time">Employed Full-Time</option>
            <option value="employed_part_time">Employed Part-Time</option>
            <option value="self_employed">Self-Employed</option>
            <option value="unemployed">Unemployed</option>
            <option value="retired">Retired</option>
            <option value="other">Other</option>
          </select>
        </div>

        <!-- Employed Fields -->
        <div id="employedFields" class="mb-4" style="display: none;">
          <div class="mb-4">
            <label for="employerName" class="block text-gray-700 mb-2">Employer Name:</label>
            <input type="text" name="employerName" id="employerName" class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>
          <div class="mb-4">
            <label for="jobTitle" class="block text-gray-700 mb-2">Job Title/Position:</label>
            <input type="text" name="jobTitle" id="jobTitle" class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>
          <div class="mb-4">
            <label for="employmentLength" class="block text-gray-700 mb-2">How long have you been employed at your current job?</label>
            <select name="employmentLength" id="employmentLength" class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
              <option value="">Select an option</option>
              <option value="<1">&lt; 1 year</option>
              <option value="1-2">1-2 years</option>
              <option value="2-5">2-5 years</option>
              <option value=">5">&gt; 5 years</option>
            </select>
          </div>
          <div class="mb-4">
            <label for="annualIncome" class="block text-gray-700 mb-2">Annual Gross Income (USD):</label>
            <input type="number" name="annualIncome" id="annualIncome" class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>
        </div>

        <!-- Self-Employed Fields -->
        <div id="selfEmployedFields" class="mb-4" style="display: none;">
          <div class="mb-4">
            <label for="businessName" class="block text-gray-700 mb-2">Business Name:</label>
            <input type="text" name="businessName" id="businessName" class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>
          <div class="mb-4">
            <label for="industry" class="block text-gray-700 mb-2">Industry:</label>
            <input type="text" name="industry" id="industry" class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>
          <div class="mb-4">
            <label for="selfEmploymentLength" class="block text-gray-700 mb-2">How long have you been self-employed?</label>
            <select name="selfEmploymentLength" id="selfEmploymentLength" class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
              <option value="">Select an option</option>
              <option value="<1">&lt; 1 year</option>
              <option value="1-2">1-2 years</option>
              <option value="2-5">2-5 years</option>
              <option value=">5">&gt; 5 years</option>
            </select>
          </div>
          <div class="mb-4">
            <label for="selfAnnualIncome" class="block text-gray-700 mb-2">Annual Gross Income (USD):</label>
            <input type="number" name="selfAnnualIncome" id="selfAnnualIncome" class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>
        </div>

        <!-- Other Fields -->
        <div id="otherFields" class="mb-4" style="display: none;">
          <div class="mb-4">
            <label for="incomeSource" class="block text-gray-700 mb-2">Please specify your primary source of income:</label>
            <input type="text" name="incomeSource" id="incomeSource" class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>
          <div class="mb-4">
            <label for="otherAnnualIncome" class="block text-gray-700 mb-2">Annual Income (USD):</label>
            <input type="number" name="otherAnnualIncome" id="otherAnnualIncome" class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>
        </div>

        <!-- Additional Income -->
        <div class="mb-4">
          <label for="additionalIncome" class="block text-gray-700 mb-2">Do you have any additional sources of income?</label>
          <select name="additionalIncome" id="additionalIncome" required class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="">Select an option</option>
            <option value="yes">Yes</option>
            <option value="no">No</option>
          </select>
        </div>
        <div id="additionalIncomeDetails" class="mb-4" style="display: none;">
          <div id="additionalIncomeEntries">
            <!-- Template for additional income entry -->
            <div class="additional-income-entry mb-4">
              <div class="mb-4">
                <label for="additionalIncomeType" class="block text-gray-700 mb-2">Type of Income:</label>
                <select name="additionalIncomeType[]" class="additionalIncomeType w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                  <option value="">Select an option</option>
                  <option value="rental_income">Rental Income</option>
                  <option value="investment_income">Investment Income</option>
                  <option value="alimony_child_support">Alimony/Child Support</option>
                  <option value="other">Other</option>
                </select>
              </div>
              <div class="mb-4">
                <label for="additionalIncomeAmount" class="block text-gray-700 mb-2">Annual Amount (USD):</label>
                <input type="number" name="additionalIncomeAmount[]" class="additionalIncomeAmount w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
              </div>
            </div>
          </div>
          <button type="button" id="addAdditionalIncome" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-300 transition">Add Another Income Source</button>
        </div>

        <button type="submit" class="bg-blue-900 text-white px-6 py-2 rounded-md hover:bg-blue-800 transition">Continue</button>
      </form>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-blue-900 text-white text-center py-4 mt-8">
    <p>Â© 2024 Pasaana. All rights reserved.</p>
  </footer>

  <!-- JavaScript for Conditional Logic -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const employmentStatus = document.getElementById('employmentStatus');
      const employedFields = document.getElementById('employedFields');
      const selfEmployedFields = document.getElementById('selfEmployedFields');
      const otherFields = document.getElementById('otherFields');
      const additionalIncome = document.getElementById('additionalIncome');
      const additionalIncomeDetails = document.getElementById('additionalIncomeDetails');
      const addAdditionalIncome = document.getElementById('addAdditionalIncome');
      const additionalIncomeEntries = document.getElementById('additionalIncomeEntries');

      employmentStatus.addEventListener('change', function() {
        // Hide all conditional sections and remove required attributes
        hideAllEmploymentFields();

        if (this.value === 'employed_full_time' || this.value === 'employed_part_time') {
          employedFields.style.display = 'block';
          // Add required attributes to inputs in employedFields
          addRequiredToFields(employedFields);
        } else if (this.value === 'self_employed') {
          selfEmployedFields.style.display = 'block';
          // Add required attributes to inputs in selfEmployedFields
          addRequiredToFields(selfEmployedFields);
        } else if (this.value === 'unemployed' || this.value === 'retired' || this.value === 'other') {
          otherFields.style.display = 'block';
          // Add required attributes to inputs in otherFields
          addRequiredToFields(otherFields);
        }
      });

      additionalIncome.addEventListener('change', function() {
        if (this.value === 'yes') {
          additionalIncomeDetails.style.display = 'block';
          // Add required attributes to inputs in additionalIncomeDetails
          addRequiredToFields(additionalIncomeDetails);
        } else {
          additionalIncomeDetails.style.display = 'none';
          // Remove required attributes
          removeRequiredFromFields(additionalIncomeDetails);
        }
      });

      addAdditionalIncome.addEventListener('click', function() {
        const newEntry = document.createElement('div');
        newEntry.classList.add('additional-income-entry', 'mb-4');
        newEntry.innerHTML = `
          <div class="mb-4">
            <label for="additionalIncomeType" class="block text-gray-700 mb-2">Type of Income:</label>
            <select name="additionalIncomeType[]" class="additionalIncomeType w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
              <option value="">Select an option</option>
              <option value="rental_income">Rental Income</option>
              <option value="investment_income">Investment Income</option>
              <option value="alimony_child_support">Alimony/Child Support</option>
              <option value="other">Other</option>
            </select>
          </div>
          <div class="mb-4">
            <label for="additionalIncomeAmount" class="block text-gray-700 mb-2">Annual Amount (USD):</label>
            <input type="number" name="additionalIncomeAmount[]" class="additionalIncomeAmount w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
          </div>
        `;
        additionalIncomeEntries.appendChild(newEntry);
      });

      function hideAllEmploymentFields() {
        employedFields.style.display = 'none';
        selfEmployedFields.style.display = 'none';
        otherFields.style.display = 'none';
        removeRequiredFromFields(employedFields);
        removeRequiredFromFields(selfEmployedFields);
        removeRequiredFromFields(otherFields);
      }

      function addRequiredToFields(section) {
        const inputs = section.querySelectorAll('input, select');
        inputs.forEach(input => {
          input.setAttribute('required', 'required');
        });
      }

      function removeRequiredFromFields(section) {
        const inputs = section.querySelectorAll('input, select');
        inputs.forEach(input => {
          input.removeAttribute('required');
        });
      }
    });
  </script>
</body>
</html>