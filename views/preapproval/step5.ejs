<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pre-Approval | <%= typeof branding !== 'undefined' ? branding.partnerName : 'Bank ABC' %> - - Step 5</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Custom Styles -->
  <link rel="stylesheet" href="/styles.css">
  <!-- Include jQuery for AJAX requests -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="bg-gradient-to-r from-blue-50 to-indigo-50 min-h-screen flex flex-col">
  <!-- Navigation Bar -->
  <%- include('../partials/navbar.ejs') %>

  <!-- Progress Bar -->
  <%- include('../partials/progress-bar.ejs', { currentStep: 5 }) %>

  <!-- Main Content -->
  <main class="flex-grow container mx-auto py-0 px-4">
    <div class="max-w-3xl mx-auto bg-white p-10 rounded-xl shadow-2xl">
      <h2 class="text-3xl font-bold text-blue-900 mb-8">Step 5: Basic Financial Information</h2>
      <form action="/preapproval/step/5" method="post" id="step5-form">
        <!-- Annual Income -->
        <div class="mb-6">
          <label for="annualIncome" class="block text-gray-800 font-medium mb-2">
            What is your total gross annual income before taxes?<span class="text-red-500">*</span>
          </label>
          <input type="number" name="annualIncome" id="annualIncome" placeholder="Enter amount in USD" required class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500">
          <p class="text-gray-600 mt-2 text-sm">
            <em>Include all income sources such as salary, wages, bonuses, and rental income.</em>
          </p>
          <p id="annualIncomeError" class="text-red-500 text-sm mt-1 hidden">Please enter a valid income amount.</p>
        </div>

        <!-- Employment Status -->
        <div class="mb-6">
          <label for="employmentStatus" class="block text-gray-800 font-medium mb-2">
            What is your current employment status?<span class="text-red-500">*</span>
          </label>
          <select name="employmentStatus" id="employmentStatus" required class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="">Select an option</option>
            <option value="Employed">Employed</option>
            <option value="Self-Employed">Self-Employed</option>
            <option value="Retired">Retired</option>
            <option value="Other">Other</option>
          </select>
        </div>

        <!-- Employed or Self-Employed Details -->
        <div id="employmentDetails" class="mb-6 hidden">
          <!-- Employer's Name -->
          <div class="mb-6">
            <label for="employerName" class="block text-gray-800 font-medium mb-2">Employer's Name<span class="text-red-500">*</span></label>
            <input type="text" name="employerName" id="employerName" placeholder="Enter your employer's name" class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <p id="employerNameError" class="text-red-500 text-sm mt-1 hidden">Please enter your employer's name.</p>
          </div>

          <!-- Length of Employment -->
          <div class="mb-6">
            <label for="employmentLength" class="block text-gray-800 font-medium mb-2">Length of Employment<span class="text-red-500">*</span></label>
            <input type="text" name="employmentLength" id="employmentLength" placeholder="e.g., 5 years, 3 months" class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <p id="employmentLengthError" class="text-red-500 text-sm mt-1 hidden">Please enter the length of your employment.</p>
          </div>
        </div>

        <!-- Other Employment Status -->
        <div id="otherEmploymentStatus" class="mb-6 hidden">
          <label for="otherEmploymentDetail" class="block text-gray-800 font-medium mb-2">Please specify your employment status<span class="text-red-500">*</span></label>
          <input type="text" name="otherEmploymentDetail" id="otherEmploymentDetail" placeholder="Enter your employment status" class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500">
          <p id="otherEmploymentDetailError" class="text-red-500 text-sm mt-1 hidden">Please specify your employment status.</p>
        </div>

        <!-- Monthly Debt Obligations -->
        <div class="mb-6">
          <label for="monthlyDebt" class="block text-gray-800 font-medium mb-2">
            What is your estimated total monthly debt payments (e.g., car loans, student loans, credit cards)?<span class="text-red-500">*</span>
          </label>
          <input type="number" name="monthlyDebt" id="monthlyDebt" placeholder="Enter amount in USD" required class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500">
          <p class="text-gray-600 mt-2 text-sm">
            <em>Include all recurring debt payments. For assistance estimating, click <a href="#" id="debtCalculatorLink" class="text-blue-600 hover:underline">here</a>.</em>
          </p>
          <p id="monthlyDebtError" class="text-red-500 text-sm mt-1 hidden">Please enter a valid debt amount.</p>
        </div>

        <!-- Debt Calculation Assistance Modal -->
        <div id="debtCalculatorModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
          <div class="bg-white rounded-lg p-6 max-w-lg w-full">
            <h3 class="text-xl font-semibold mb-4">Monthly Debt Calculation Assistance</h3>
            <p class="mb-4">Add up your monthly payments for the following debts:</p>
            <ul class="list-disc list-inside mb-4">
              <li>Car Loans</li>
              <li>Student Loans</li>
              <li>Credit Card Minimum Payments</li>
              <li>Personal Loans</li>
              <li>Any Other Debt Payments</li>
            </ul>
            <p class="mb-2">For example, if you pay:</p>
            <ul class="list-disc list-inside mb-4">
              <li>$200 for car loan</li>
              <li>$150 for student loan</li>
              <li>$50 for credit cards</li>
            </ul>
            <p>Your total monthly debt payments would be <strong>$400</strong>.</p>
            <button id="closeDebtCalculator" class="mt-4 bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition">Close</button>
          </div>
        </div>

        <button type="submit" class="w-full bg-blue-900 text-white py-3 mt-6 rounded-full font-semibold text-lg shadow-md hover:bg-blue-800 transition duration-300">Continue</button>
      </form>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-blue-900 text-white text-center py-6">
    <p><%= typeof branding !== 'undefined' ? branding.copyright : 'Â© 2025 Bank ABC. All rights reserved.' %></p>
  </footer>

  <!-- JavaScript for Validation and Interactivity -->
  <script>
    $(document).ready(function() {
      // Employment Status Change Handler
      $('#employmentStatus').on('change', function() {
        const status = $(this).val();
        if (status === 'Employed' || status === 'Self-Employed') {
          $('#employmentDetails').removeClass('hidden');
          $('#employerName, #employmentLength').prop('required', true);
          $('#otherEmploymentStatus').addClass('hidden');
          $('#otherEmploymentDetail').prop('required', false);
        } else if (status === 'Other') {
          $('#otherEmploymentStatus').removeClass('hidden');
          $('#otherEmploymentDetail').prop('required', true);
          $('#employmentDetails').addClass('hidden');
          $('#employerName, #employmentLength').prop('required', false);
        } else {
          $('#employmentDetails').addClass('hidden');
          $('#employerName, #employmentLength').prop('required', false);
          $('#otherEmploymentStatus').addClass('hidden');
          $('#otherEmploymentDetail').prop('required', false);
        }
      });

      // Real-time validation for Annual Income
      $('#annualIncome').on('input', function() {
        const isValid = $(this).val() !== '' && !isNaN($(this).val()) && parseFloat($(this).val()) >= 0;
        $('#annualIncomeError').toggleClass('hidden', isValid);
      });

      // Real-time validation for Monthly Debt
      $('#monthlyDebt').on('input', function() {
        const isValid = $(this).val() !== '' && !isNaN($(this).val()) && parseFloat($(this).val()) >= 0;
        $('#monthlyDebtError').toggleClass('hidden', isValid);
      });

      // Debt Calculator Modal
      $('#debtCalculatorLink').on('click', function(e) {
        e.preventDefault();
        $('#debtCalculatorModal').removeClass('hidden');
      });

      $('#closeDebtCalculator').on('click', function() {
        $('#debtCalculatorModal').addClass('hidden');
      });

      // Form submission validation
      $('#step5-form').on('submit', function(e) {
        let isFormValid = true;

        // Annual Income validation
        if ($('#annualIncome').val() === '' || isNaN($('#annualIncome').val()) || parseFloat($('#annualIncome').val()) < 0) {
          $('#annualIncomeError').removeClass('hidden');
          isFormValid = false;
        }

        // Monthly Debt validation
        if ($('#monthlyDebt').val() === '' || isNaN($('#monthlyDebt').val()) || parseFloat($('#monthlyDebt').val()) < 0) {
          $('#monthlyDebtError').removeClass('hidden');
          isFormValid = false;
        }

        // Employment Details validation
        const employmentStatus = $('#employmentStatus').val();
        if (employmentStatus === '') {
          isFormValid = false;
        } else if (employmentStatus === 'Employed' || employmentStatus === 'Self-Employed') {
          if ($('#employerName').val().trim() === '') {
            $('#employerNameError').removeClass('hidden');
            isFormValid = false;
          }
          if ($('#employmentLength').val().trim() === '') {
            $('#employmentLengthError').removeClass('hidden');
            isFormValid = false;
          }
        } else if (employmentStatus === 'Other') {
          if ($('#otherEmploymentDetail').val().trim() === '') {
            $('#otherEmploymentDetailError').removeClass('hidden');
            isFormValid = false;
          }
        }

        if (!isFormValid) {
          e.preventDefault();
        }
      });
    });
  </script>
</body>
</html>